<section xmlns:th="http://www.thymeleaf.org"
         xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
         layout:decorate="~{fragments/admin-layout}"
         layout:fragment="body">

    <div class="container mt-5 mb-5 w-75">
        <h2 class="mb-4 fw-bold text-primary text-center">üì¶ Chi ti·∫øt ƒë∆°n h√†ng</h2>

        <!-- Th√¥ng tin ƒë∆°n h√†ng -->
        <div class="card shadow-sm rounded-4 mb-4">
            <div class="card-body">
                <h5 class="card-title text-dark fw-semibold mb-3">
                    M√£ ƒë∆°n h√†ng: <span class="text-primary">#<span th:text="${order.orderId}"></span></span>
                </h5>

                <p><strong>Tr·∫°ng th√°i:</strong>
                    <span th:switch="${order.status}">
                        <span th:case="'Pending'" class="badge bg-warning text-dark px-3 py-2 fs-6 rounded-pill">Ch·ªù x√°c nh·∫≠n</span>
                        <span th:case="'Processing'" class="badge bg-primary px-3 py-2 fs-6 rounded-pill">ƒêang x·ª≠ l√Ω</span>
                        <span th:case="'Shipped'" class="badge bg-info text-dark px-3 py-2 fs-6 rounded-pill">ƒê√£ giao h√†ng</span>
                        <span th:case="'Completed'" class="badge bg-success px-3 py-2 fs-6 rounded-pill">Ho√†n th√†nh</span>
                        <span th:case="'Cancelled'" class="badge bg-danger px-3 py-2 fs-6 rounded-pill">ƒê√£ h·ªßy</span>
                        <span th:case="*">Kh√¥ng x√°c ƒë·ªãnh</span>
                    </span>
                </p>

                <p><strong>T·ªïng ti·ªÅn:</strong> <span class="text-dark fw-bold" th:text="${order.totalAmount} + '$'"></span></p>
                <p><strong>Gi·∫£m gi√°:</strong> 
                    <span th:text="${order.discountAmount != null ? order.discountAmount + '$' : '0$'}" class="text-secondary"></span>
                </p>
                <p><strong>Ng∆∞·ªùi ƒë·∫∑t:</strong> <span th:text="${order.user.fullName}" class="text-dark"></span></p>
                <p><strong>Ng√†y t·∫°o:</strong> 
                    <span class="text-muted" th:text="${#temporals.format(order.createdAt, 'dd/MM/yyyy HH:mm')}"></span>
                </p>
            </div>
        </div>

        <!-- H√†nh ƒë·ªông -->
        <div class="d-flex gap-3 mb-4" th:if="${order.status != 'Completed' and order.status != 'Cancelled'}">
            <form th:action="@{'/admin/orders/' + ${order.orderId} + '/next'}" method="post">
                <button type="submit" class="btn btn-outline-success px-4"><i class="bi bi-arrow-repeat me-1"></i>C·∫≠p nh·∫≠t b∆∞·ªõc ti·∫øp theo</button>
            </form>

            <form th:action="@{'/admin/orders/' + ${order.orderId} + '/cancel'}" method="post"
                  onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën h·ªßy ƒë∆°n h√†ng n√†y kh√¥ng?');">
                <button type="submit" class="btn btn-outline-danger px-4"><i class="bi bi-x-circle me-1"></i>H·ªßy ƒë∆°n h√†ng</button>
            </form>
        </div>

        <!-- Danh s√°ch s·∫£n ph·∫©m -->
        <div class="card shadow-sm rounded-4">
            <div class="card-body">
                <h4 class="mb-3 text-center text-secondary fw-semibold">üõí S·∫£n ph·∫©m trong ƒë∆°n h√†ng</h4>
                <div class="table-responsive">
                    <table class="table table-bordered table-hover text-center align-middle">
                        <thead class="table-light sticky-top">
                            <tr>
                                <th>S·∫£n ph·∫©m</th>
                                <th>S·ªë l∆∞·ª£ng</th>
                                <th>ƒê∆°n gi√°</th>
                                <th>Th√†nh ti·ªÅn</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="item : ${order.orderDetails}">
                                <td th:text="${item.product.productName}"></td>
                                <td th:text="${item.quantity}"></td>
                                <td th:text="${item.price} + '$'"></td>
                                <td th:text="${item.price * item.quantity} + '$'"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="text-center mt-4">
            <a th:href="@{/admin/orders}" class="btn btn-secondary"><i class="bi bi-arrow-left me-1"></i> Quay l·∫°i</a>
        </div>
    </div>
</section>
